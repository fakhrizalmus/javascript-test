<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beam Analysis Plot</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <form>
        <table>
            <tr>
                <td>Condition</td>
                <td>
                    <select name="condition" id="condition">
                        <option value="simply-supported">Simply Supported</option>
                        <option value="two-span-unequal">Two Span Unequal</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Load Force (w)</td>
                <td><input type="text" id="w"> kN/m</td>
            </tr>
            <tr>
                <td>Primary Span (L1)</td>
                <td><input type="text" id="primarySpan" value="4"> m</td>
            </tr>
            <tr>
                <td>Secondary Span (L2)</td>
                <td><input type="text" id="secondarySpan" value=""> m</td>
            </tr>
            <tr>
                <td colspan="2"><hr></td>
            </tr>
            <tr>
                <td>j2</td>
                <td><input type="text" id="j2" value="2"></td>
            </tr>
            <tr>
                <td>Bending Stiffnes (EI)</td>
                <td><input type="text" id="EI" value="3150000000000"> Nmm<sup>2</sup></td>
            </tr>

            <tr>
                <td colspan="2"><hr></td>
            </tr>

            <tr>
                <td colspan="2" style="text-align: center;">
                    <button type="button" id="calculate">Calculate</button>
                </td>
            </tr>
        </table>
    </form>
    <canvas id="deflection_plot" width="600" height="400"></canvas>
    <canvas id="shear_force_plot" width="600" height="400"></canvas>
    <canvas id="bending_moment_plot" width="600" height="400"></canvas>

    <script src="js/beam-analysis.js"></script>
    <script src="js/analysis-plotter.js"></script>

    <script>
        /**
         * Get float value of specified field
         */
        function floatVal(id) {
            return parseFloat(
                document.getElementById(id).value
            );
        }

        function stringVal(id) {
            return document.getElementById(id).value;
        }

        function generatePlotData(equation, maxSpan, step = 0.1) {
            const xValues = [];
            const yValues = [];
            for (let x = 0; x <= maxSpan; x += step) {
                xValues.push(x);
                yValues.push(equation(x).y);
            }
            return { x: xValues, y: yValues };
        }

        document.getElementById('calculate').addEventListener('click', function(e) {
            const beam = new Beam(
                floatVal('primarySpan'),
                floatVal('secondarySpan'),
                new Material('No Name', { EI: floatVal('EI') })
            );

            const maxSpan = beam.primarySpan + (beam.secondarySpan || 0);

            const beamAnalysis = new BeamAnalysis();

            const deflectionEquation = beamAnalysis.getDeflection(beam, floatVal('w'), stringVal('condition')).equation;
            const bendingMomentEquation = beamAnalysis.getBendingMoment(beam, floatVal('w'), stringVal('condition')).equation;
            const shearForceEquation = beamAnalysis.getShearForce(beam, floatVal('w'), stringVal('condition')).equation;

            const deflectionData = generatePlotData(deflectionEquation, maxSpan);
            const bendingMomentData = generatePlotData(bendingMomentEquation, maxSpan);
            const shearForceData = generatePlotData(shearForceEquation, maxSpan);

            const plotter = {
                deflection: new AnalysisPlotter('deflection_plot'),
                bendingMoment: new AnalysisPlotter('bending_moment_plot'),
                shearForce: new AnalysisPlotter('shear_force_plot')
            };

            plotter.deflection.plot(deflectionData, { type: 'line', label: 'Deflection', xLabel: 'Position (x)', yLabel: 'Deflection (y)' });
            plotter.bendingMoment.plot(bendingMomentData, { type: 'line', label: 'Bending Moment', xLabel: 'Position (x)', yLabel: 'Bending Moment (y)' });
            plotter.shearForce.plot(shearForceData, { type: 'line', label: 'Shear Force', xLabel: 'Position (x)', yLabel: 'Shear Force (y)' });
        });
    </script>
</body>
</html>